import{h as G}from"./DDfH5Ihl.js";import{K,d as H,v as _,n as C,V as B,W as Y,X as ee,Y as te,a as ne,Q as ae,f as w,Z as M,S as Z,_ as le,a0 as L,k as oe,F as V,a1 as se,a2 as Ae,a3 as re,a4 as ie,a5 as ue}from"./BHs5J4y9.js";function ce(t=K()){var a;return(a=t.ssrContext)==null?void 0:a.event}const de={trailing:!0};function fe(t,a=25,i={}){if(i={...de,...i},!Number.isFinite(a))throw new TypeError("Expected `wait` to be a finite number");let S,c,u=[],s,d;const r=(v,l)=>(s=ve(t,v,l),s.finally(()=>{if(s=null,i.trailing&&d&&!c){const A=r(v,d);return d=null,A}}),s);return function(...v){return s?(i.trailing&&(d=v),s):new Promise(l=>{const A=!c&&i.leading;clearTimeout(c),c=setTimeout(()=>{c=null;const x=i.leading?S:r(this,v);for(const m of u)m(x);u=[]},a),A?(S=r(this,v),l(S)):u.push(l)})}}async function ve(t,a,i){return await t.apply(a,i)}const R="_islandPromises",me=/data-island-uid="([^"]*)"/,pe=/data-island-uid(="")?(?!="[^"])/g,ye=/data-island-slot="([^"]*)"/g,ge=/ data-island-slot="([^"]*)"[^>]*>/g;let he=1;const _e=()=>(he++).toString();const Se=H({name:"NuxtIsland",props:{name:{type:String,required:!0},lazy:Boolean,props:{type:Object,default:()=>{}},context:{type:Object,default:()=>({})},scopeId:{type:String,default:()=>{}},source:{type:String,default:()=>{}},dangerouslyLoadClientComponents:{type:Boolean,default:!1}},emits:["error"],async setup(t,{slots:a,expose:i,emit:S}){var O,N,j,z,U;let c=!1;const u=_(0),s=_(0),d=C(()=>B),r=_(null),v=ue(),l=K(),A=C(()=>t.props?Object.fromEntries(Object.entries(t.props).filter(([n])=>!n.startsWith("data-v-"))):{}),x=C(()=>G([t.name,A.value,t.context,t.source])),m=Z();ce();const W=globalThis.fetch,k=_(!1);Y(()=>{k.value=!0,u.value++});function q(n,e){const o={};e.props&&(o.props=e.props),e.slots&&(o.slots=e.slots),e.components&&(o.components=e.components),l.payload.data[n]={__nuxt_island:{key:n,params:{...t.context,props:t.props?JSON.stringify(t.props):void 0},result:o},...e}}const p={};if(m.vnode.el){const n=(O=ee(l.payload.data[`${t.name}_${x.value}`]))==null?void 0:O.slots;n&&(p.slots=n)}const E=_("");if((N=m.vnode)!=null&&N.el){E.value=((j=te(m.vnode.el,!0))==null?void 0:j.join(""))||"";const n=`${t.name}_${x.value}`;(z=l.payload.data)[n]||(z[n]={}),l.payload.data[n].html=E.value}const y=_(((U=E.value.match(me))==null?void 0:U[1])??_e()),J=C(()=>[...E.value.matchAll(ye)].map(n=>n[1])),$=C(()=>{const n=Object.keys(a);let e=E.value;if(t.scopeId&&(e=e.replace(/^<[^> ]*/,o=>o+" "+t.scopeId)),!d.value)for(const[o,g]of Object.entries(p.components||{}))e=e.replace(new RegExp(` data-island-uid="${y.value}" data-island-component="${o}"[^>]*>`),f=>f+g.html);return p.slots?e.replaceAll(ge,(o,g)=>{var f,h;return n.includes(g)?o:o+(((h=(f=p.slots)==null?void 0:f[g])==null?void 0:h.fallback)||"")}):e}),b=_({link:[],style:[]});ne(b);async function Q(n=!1){var h;const e=`${t.name}_${x.value}`;if(!n&&((h=l.payload.data[e])!=null&&h.html))return l.payload.data[e];const o=`/__nuxt_island/${e}.json`,f=await(await W(re(t.source?o:ie(v.app.baseURL??"",o),{...t.context,props:t.props?JSON.stringify(t.props):void 0}))).json();return q(e,f),f}async function I(n=!1){l[R]=l[R]||{},l[R][y.value]||(l[R][y.value]=Q(n).finally(()=>{delete l[R][y.value]}));try{const e=await l[R][y.value];b.value.link=e.head.link,b.value.style=e.head.style,E.value=e.html.replaceAll(pe,`data-island-uid="${y.value}"`),s.value++,r.value=null,p.slots=e.slots||{},p.components=e.components||{},le(()=>{c=!0,u.value++})}catch(e){r.value=e,S("error",e)}}return i({refresh:()=>I(!0)}),ae(t,fe(()=>I(),100),{deep:!0}),!m.vnode.el&&t.lazy?I():(!m.vnode.el||!l.payload.serverRendered)&&await I(),(n,e)=>{var o;return!$.value||r.value?[((o=a.fallback)==null?void 0:o.call(a,{error:r.value}))??w("div")]:[M([s.value],()=>w(V,{key:s.value},[L(oe($.value||"<div></div>",1))]),e,0),M([u.value],()=>{var h;const g=[],f=u.value===0||!!(u.value&&!(u.value%2));if(y.value&&$.value&&(t.lazy?c:k.value||(h=m.vnode)!=null&&h.el))for(const T in a)J.value.includes(T)&&g.push(w(se,{to:`${f?"div":""}[data-island-uid="${y.value}"][data-island-slot="${T}"]`},{default:()=>{var P,D;return((D=(P=p.slots)==null?void 0:P[T].props)!=null&&D.length?p.slots[T].props:[{}]).map(X=>{var F;return(F=a[T])==null?void 0:F.call(a,X)})}}));return L(V,g)},e,1)]}}}),xe=t=>H({name:t,inheritAttrs:!1,props:{lazy:Boolean},emits:["error"],setup(a,{attrs:i,slots:S,expose:c,emit:u}){const s=Z(),d=_(null);return c({refresh:()=>{var r;return(r=d.value)==null?void 0:r.refresh()}}),()=>L(Se,{name:t,lazy:a.lazy,props:i,scopeId:s==null?void 0:s.vnode.scopeId,ref:d,onError:r=>{u("error",r)}},S)}});export{xe as c};
